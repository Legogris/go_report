<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Go Report Card | A Gopher Gala Hackathon Product</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <style>
    /* Page header 
    -------------------------------------------------- */
    .header {
      text-align: center;
    }
    .header h2 {
      font-size: 3em;
    }
    .input-row {
      margin-top: 20px;
    }
    .input-row input.input-box {
        width: 100%;
        height: 46px;
    }
    .btn-test {
        width: 100%;
    }
    .url label {
        z-index: 2;
        position: absolute;
        line-height: 46px;
        font-weight: normal;
        color: rgb(51, 51, 51);
        font-weight: 200;
    }
    .url input {
        position: absolute;
        right: 0;
        z-index: 1;
        margin-left: -190px;
        padding-left: 190px;
    }

    /* Results section
    -------------------------------------------------- */
    .results {
      width: 100%;
    }
    .results .head-row {
      cursor: pointer;
    }
    .results .cell-description {
      width: 30%;
    }
    .results .cell-progress-bar {
      width: 70%;
    }
    .results .files, .results .errors {
      padding-left: 0;
    }
    .results .files .file {
      list-style-type: none;
      padding-left: 0;
    }
    .results .files .errors .error {
      list-style-type: none;
      padding-left: 4em;
      margin: 1em 0;
    }
    .results .progress {
      margin-bottom: 0;
    }
    .results .details-row:hover {
      background: inherit;
    }
    .results .perfect {
      color: #aaa;
    }
    .results-text p {
      font-size: 1.5em;
    }
    .huge {
      font-size: 3em;
      font-weight: bold;
    }
    .results .tool-description {
      color: #666;
    }

    /* Partials section
    -------------------------------------------------- */
    #partials {
      display: none;
    }
    .alert {
      margin-bottom: 0;
    }
    .gopher {
      width: 150px;
    }

    /* Footer section!
    -------------------------------------------------- */
    .footer-text {
      text-align: center;
      line-height: 4em;
    }

    /* Sticky footer
    -------------------------------------------------- */
    html {
      position: relative;
      min-height: 100%;
    }
    body {
      /* Margin bottom by footer height */
      margin-bottom: 60px;
    }
    .footer {
      position: absolute;
      bottom: 0;
      width: 100%;
      /* Set the fixed height of the footer here */
      height: 60px;
      background-color: #f5f5f5;
    }
    </style>
</head>
<body>
  <div id="notifications">
  </div>
  <div class="jumbotron">
    <div class="container">
      <div class="row header">
        <div class="col-md-8 col-md-offset-2">
          <h2 class="title">Go Report Card</h2>
          <p class="description">Enter the <strong>Github URL</strong> below to generate a report on the quality of the Go code in the project</p>
        </div>
      </div>
      <div class="row input-row">
        <div class="col-md-8 col-md-offset-2">
          <form method="GET" action="/checks" id="check-form">
            <div class="col-md-9">
              <p class="url">
                <label>https://github.com/</label><input name="repo" type="text" class="input-box" placeholder="gojp/nihongo"/>
              </p>
            </div>
            <div class="col-md-3">
              <button type="submit" class="btn btn-primary btn-lg" href="#" role="button" class="btn-test">Test Now</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row container-gopher">
      <div class="col-md-12 text-center">
        <img src="/assets/gopherhat.jpg" class="gopher" />
      </div>
    </div>
    <div class="row container-results hidden">
      <div class="col-md-10 col-md-offset-1 results-text">
      </div>
      <div class="col-md-10 col-md-offset-1">
        <table class="table table-hover results">
        </table>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <p class="footer-text">
          Made by 
            <a href="https://twitter.com/shawnps">@shawnps</a>, 
            <a href="https://twitter.com/legogris">@legogris</a>, 
            <a href="https://twitter.com/dallarosajp">@dallarosajp</a> and 
            <a href="https://twitter.com/ironzeb">@ironzeb</a> during the 2014 <a href="http://gophergala.com">Gopher Gala</a> Hackathon. The Go Gopher was created by <a href="http://reneefrench.blogspot.com/">Ren√©e French</a>
          </p>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.js"></script>
  <script id="template-alert" type="text/x-handlebars-template">
    <div class="alert alert-warning alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="message">
      {{{message}}}
      </div>
    </div>
  </script>
  <script id="template-grade" type="text/x-handlebars-template">
    <div>
      <div class="col-md-6">
        <p><span class="huge">{{grade}}</span> &nbsp;&nbsp; {{gradeMessage grade}}</p>
      </div>
      <div class="col-md-6 text-right">
        <p>Found <span class="huge">{{issues}}</span> issues across <span class="huge">{{files}}</span> files</p>
      </div>
    </div>
  </script>
  <script id="template-check" type="text/x-handlebars-template">
    <tr class="head-row">
      <td class="cell-description">
        {{{name}}}
      </td>
      <td class="cell-progress-bar">
        <div class="progress">
          <div class="progress-bar progress-bar-{{color percentage}}" role="progressbar" aria-valuenow="{{percentage}}" aria-valuemin="0" aria-valuemax="100" style="width: {{percentage}}%;">
            {{percentage}}%
          </div>
        </div>
      </td>
    </tr>
  </script>
  <script id="template-details" type="text/x-handlebars-template">
    <tr class="details-row hidden">
      <td colspan="2">
        <div class="wrapper">
          <p class="tool-description">{{{description}}}</p>
        {{^file_summaries}}
          <p class="perfect">No problems detected. Good job!</p>
        {{/file_summaries}}
        {{#each file_summaries}}
          <ul class="files">
            <li class="file">
              <ul class="errors">
              <a href="{{this.file_url}}">{{this.filename}}</a>
              {{#each this.errors}}
                {{#if line_number}}
                <li class="error"><a href="{{../../file_url}}#L{{this.line_number}}">Line {{this.line_number}}</a>: {{this.error_string}}</li>
                {{/if}}
              {{/each}}
              </ul>
            </li>
          </ul>
        {{/each}}
        </div>
      </td>
    </tr>
  </script>
  <script type="text/javascript">
    var loading = false;

    // add a helper for getting the grade for a percentage
    var getGrade = function(percentage) {
      switch(true){
        case percentage > 90:
          return "A+";
        case percentage > 80:
          return "A";
        case percentage > 70:
          return "B";
        case percentage > 60:
          return "C";
        case percentage > 50:
          return "D";
        case percentage > 40:
          return "E";
        default:
          return "F";
      }
    };

    Handlebars.registerHelper('gradeMessage', function(grade, options) {
      var gradeMessages = {
        "A+": "Excellent!",
        "A": "Great!",
        "B": "Not bad!",
        "C": "Needs some work",
        "D": "Needs lots improvement",
        "E": "Urgent improvement needed",
        "F": "... is for lots of things to Fix!"
      };
      return gradeMessages[grade];
    });

    // add a helper for picking the progress bar colors
    Handlebars.registerHelper('color', function(percentage, options) {
      switch(true){
        case percentage < 30:
          return 'danger';
        case percentage < 50:
          return 'warning';
        case percentage < 80:
          return 'info';
        default:
          return 'success';
      };
    });

    Handlebars.registerHelper('isfalse', function(percentage, options) {
      return percentage == false;
    });

    // initialize handlebars templates
    var templates = {};
    $("script[id^=template]").each(function(){
      var name = $(this).attr("id").substring(9);
      var source   = $(this).html();
      templates[name] = Handlebars.compile(source);
    });

    var shrinkHeader = function(){
      var $header = $(".header");
      $header.find(".title, .description").slideUp();
    }

    function spinGopher(){
      if (!loading) {
        return false;
      };
      var $gopher = $(".gopher"),
          angle = 360;
      $({deg: 0}).animate({deg: angle}, {
        duration: 1000,
        step: function(now) {
          $gopher.css({
              transform: 'rotate(' + now + 'deg)'
          });
        },
        easing: 'linear',
        always: spinGopher
      });
      return true;
    }

    function hideGopher(){
      $(".container-gopher").hide();
    }

    function showGopher(){
      $(".container-gopher").show();
      spinGopher();
    }

    var populateResults = function(data){
        var checks = data.checks;
        var $resultsText = $(".results-text");
        data.grade = getGrade(data.average * 100);
        $resultsText.html($(templates.grade(data)));

        var $table = $(".table.results");
        $table.empty();
        for (var i = 0; i < checks.length; i++) {
            checks[i].percentage = parseInt(checks[i].percentage * 100.0);
            var $headRow = $(templates.check(checks[i]));
            $headRow.on("click", function(){
              $(this).next(".details-row").toggleClass('hidden');
              
            });
            $headRow.appendTo($table);

            var $details = $(templates.details(checks[i]));
            $details.appendTo($table);
        }
        $(".container-results").removeClass('hidden').slideDown();
    };

    var hideResults = function(){
      $(".container-results").hide();
    }

    // on ready
    $(function(){

      // handle form submission
      $("form#check-form").submit(function(){
        loading = true;
        var $form = $(this),
            url = $form.attr("action"),
            method = $form.attr("method"),
            data = {};
        shrinkHeader();
        hideResults();
        showGopher();
        $form.serializeArray().map(function(x){data[x.name] = x.value;}); 
        $.ajax({
            type: "POST",
            url: url,
            data: data,
            dataType: "json"
        }).fail(function(xhr, status, err){;
            var html = templates.alert({message: "<strong>Oops!</strong> There was an error processing your request: " + err});
            var $alert = $(html);
            $alert.on("click", function(){
              $(this).closest(".alert").remove();
            });
            $alert.hide();
            $alert.appendTo("#notifications");
            $alert.slideDown();
        }).done(function(data, textStatus, jqXHR){
            hideGopher();
            populateResults(data);
        }).always(function(){
            loading = false;
        });
        history.pushState('', "Go Report Card for " + data.repo + " | A Gopher Gala Hackathon Product", "/report/" + data.repo);
        return false;
      });


      var path = window.location.pathname;
      if (path.indexOf("/report/") == 0) {
        repo = path.replace(/^\/report\//, "");
        $("form#check-form").find("input").val(repo).submit();
      }
      
    });

    // // for testing:
    // hideGopher();
    // populateResults([{"name":"gocyclo","file_summaries":[],"percentage":1},{"name":"golint","file_summaries":[{"filename":"/github.com/gojp/nihongo/app/controllers/app.go","file_url":"https://github.com/gojp/nihongo/blob/master/app/controllers/app.go","errors":[{"line_number":20,"error_string":" exported type App should have comment or be unexported"},{"line_number":25,"error_string":" exported type Word should have comment or be unexported"},{"line_number":29,"error_string":" exported type ByCommon should have comment or be unexported"},{"line_number":35,"error_string":" exported type PopularSearch should have comment or be unexported"},{"line_number":65,"error_string":" exported method App.Search should have comment or be unexported"},{"line_number":65,"error_string":" receiver name a should be consistent with previous receiver name c for App"},{"line_number":82,"error_string":" exported method App.Details should have comment or be unexported"},{"line_number":118,"error_string":" exported method App.SearchGet should have comment or be unexported"},{"line_number":125,"error_string":" exported method App.About should have comment or be unexported"},{"line_number":129,"error_string":" exported method App.Resources should have comment or be unexported"},{"line_number":133,"error_string":" exported method App.SavePhrase should have comment or be unexported"},{"line_number":133,"error_string":" receiver name a should be consistent with previous receiver name c for App"},{"line_number":177,"error_string":" exported method App.Register should have comment or be unexported"},{"line_number":182,"error_string":" exported method App.LoginPage should have comment or be unexported"},{"line_number":187,"error_string":" exported method App.Profile should have comment or be unexported"},{"line_number":193,"error_string":" exported method App.SaveUser should have comment or be unexported"},{"line_number":209,"error_string":" if block ends with a return statement, so drop this else and outdent its block"},{"line_number":228,"error_string":" exported method App.Login should have comment or be unexported"},{"line_number":244,"error_string":" exported method App.Logout should have comment or be unexported"},{"line_number":251,"error_string":" exported method App.Index should have comment or be unexported"}]},{"filename":"/github.com/gojp/nihongo/app/helpers/search.go","file_url":"https://github.com/gojp/nihongo/blob/master/app/helpers/search.go","errors":[{"line_number":26,"error_string":" exported function Search should have comment or be unexported"},{"line_number":101,"error_string":" var searchJson should be searchJSON"},{"line_number":135,"error_string":" var searchJson should be searchJSON"}]},{"filename":"/github.com/gojp/nihongo/app/models/edict.go","file_url":"https://github.com/gojp/nihongo/blob/master/app/models/edict.go","errors":[{"line_number":7,"error_string":" exported type WordModel should have comment or be unexported"},{"line_number":17,"error_string":" exported type SearchTerm should have comment or be unexported"}]},{"filename":"/github.com/gojp/nihongo/app/models/gloss.go","file_url":"https://github.com/gojp/nihongo/blob/master/app/models/gloss.go","errors":[{"line_number":3,"error_string":" exported type Gloss should have comment or be unexported"}]},{"filename":"/github.com/gojp/nihongo/app/models/user.go","file_url":"https://github.com/gojp/nihongo/blob/master/app/models/user.go","errors":[{"line_number":10,"error_string":" exported type User should have comment or be unexported"},{"line_number":22,"error_string":" exported method User.Validate should have comment or be unexported"},{"line_number":22,"error_string":" receiver name user should be consistent with previous receiver name u for User"},{"line_number":28,"error_string":" exported function ValidatePassword should have comment or be unexported"}]},{"filename":"/github.com/gojp/nihongo/app/models/word.go","file_url":"https://github.com/gojp/nihongo/blob/master/app/models/word.go","errors":[{"line_number":10,"error_string":" exported type Word should have comment or be unexported"},{"line_number":26,"error_string":" comment on exported method Word.HighlightQuery should be of the form \"HighlightQuery ...\""}]},{"filename":"/github.com/gojp/nihongo/app/routes/routes.go","file_url":"https://github.com/gojp/nihongo/blob/master/app/routes/routes.go","errors":[{"line_number":1,"error_string":" package comment should be of the form \"Package routes ...\""},{"line_number":8,"error_string":" exported var App should have comment or be unexported"},{"line_number":11,"error_string":" receiver name should not be an underscore"},{"line_number":20,"error_string":" receiver name should not be an underscore"},{"line_number":29,"error_string":" receiver name should not be an underscore"},{"line_number":36,"error_string":" receiver name should not be an underscore"},{"line_number":43,"error_string":" receiver name should not be an underscore"},{"line_number":50,"error_string":" receiver name should not be an underscore"},{"line_number":59,"error_string":" receiver name should not be an underscore"},{"line_number":66,"error_string":" receiver name should not be an underscore"},{"line_number":73,"error_string":" receiver name should not be an underscore"},{"line_number":80,"error_string":" receiver name should not be an underscore"},{"line_number":89,"error_string":" receiver name should not be an underscore"},{"line_number":100,"error_string":" receiver name should not be an underscore"},{"line_number":107,"error_string":" receiver name should not be an underscore"},{"line_number":116,"error_string":" exported var Static should have comment or be unexported"},{"line_number":119,"error_string":" receiver name should not be an underscore"},{"line_number":130,"error_string":" receiver name should not be an underscore"},{"line_number":145,"error_string":" exported var TestRunner should have comment or be unexported"},{"line_number":148,"error_string":" receiver name should not be an underscore"},{"line_number":155,"error_string":" receiver name should not be an underscore"},{"line_number":166,"error_string":" receiver name should not be an underscore"}]},{"filename":"/github.com/gojp/nihongo/tests/apptest.go","file_url":"https://github.com/gojp/nihongo/blob/master/tests/apptest.go","errors":[{"line_number":12,"error_string":" exported type Word should have comment or be unexported"},{"line_number":16,"error_string":" exported type PopularSearch should have comment or be unexported"},{"line_number":20,"error_string":" exported type ScoreWord should have comment or be unexported"},{"line_number":36,"error_string":" exported type AppTest should have comment or be unexported"},{"line_number":40,"error_string":" exported method AppTest.Before should have comment or be unexported"},{"line_number":43,"error_string":" exported method AppTest.TestThatIndexPageWorks should have comment or be unexported"},{"line_number":49,"error_string":" exported method AppTest.TestThatHelloSearchPageWorks should have comment or be unexported"},{"line_number":55,"error_string":" exported method AppTest.TestThatKonnichiwaSearchPageWorks should have comment or be unexported"},{"line_number":61,"error_string":" exported method AppTest.TestThatDoublePlusSearchWorks should have comment or be unexported"},{"line_number":67,"error_string":" exported method AppTest.TestSearchResults should have comment or be unexported"},{"line_number":93,"error_string":" exported method AppTest.TestSearchResultScores should have comment or be unexported"},{"line_number":112,"error_string":" exported method AppTest.After should have comment or be unexported"}]},{"filename":"/github.com/gojp/nihongo/tests/helperstest.go","file_url":"https://github.com/gojp/nihongo/blob/master/tests/helperstest.go","errors":[{"line_number":8,"error_string":" exported type HelpersTest should have comment or be unexported"},{"line_number":12,"error_string":" exported method HelpersTest.Before should have comment or be unexported"},{"line_number":15,"error_string":" exported method HelpersTest.After should have comment or be unexported"},{"line_number":18,"error_string":" exported method HelpersTest.TestMakeStrong should have comment or be unexported"},{"line_number":23,"error_string":" exported method HelpersTest.TestConvertQueryToKana should have comment or be unexported"}]},{"filename":"/github.com/gojp/nihongo/tests/modelstest.go","file_url":"https://github.com/gojp/nihongo/blob/master/tests/modelstest.go","errors":[{"line_number":8,"error_string":" exported type ModelsTest should have comment or be unexported"},{"line_number":12,"error_string":" exported method ModelsTest.Before should have comment or be unexported"},{"line_number":15,"error_string":" exported method ModelsTest.After should have comment or be unexported"},{"line_number":18,"error_string":" exported method ModelsTest.TestHighlightQuery should have comment or be unexported"}]}],"percentage":0.2857142857142857},{"name":"go_vet","file_summaries":[{"filename":"/github.com/gojp/nihongo/tests/apptest.go","file_url":"https://github.com/gojp/nihongo/blob/master/tests/apptest.go","errors":[{"line_number":106,"error_string":" Println call ends with newline"}]}],"percentage":0.9285714285714286},{"name":"gofmt","file_summaries":[{"filename":"/github.com/gojp/nihongo/app/controllers/app.go","file_url":"https://github.com/gojp/nihongo/blob/master/app/controllers/app.go","errors":[{"line_number":0,"error_string":"repos/src/github.com/gojp/nihongo/app/controllers/app.go"}]},{"filename":"/github.com/gojp/nihongo/app/routes/routes.go","file_url":"https://github.com/gojp/nihongo/blob/master/app/routes/routes.go","errors":[{"line_number":0,"error_string":"repos/src/github.com/gojp/nihongo/app/routes/routes.go"}]},{"filename":"/github.com/gojp/nihongo/tests/apptest.go","file_url":"https://github.com/gojp/nihongo/blob/master/tests/apptest.go","errors":[{"line_number":0,"error_string":"repos/src/github.com/gojp/nihongo/tests/apptest.go"}]},{"filename":"/github.com/gojp/nihongo/tests/search_test.go","file_url":"https://github.com/gojp/nihongo/blob/master/tests/search_test.go","errors":[{"line_number":0,"error_string":"repos/src/github.com/gojp/nihongo/tests/search_test.go"}]}],"percentage":0.7142857142857143}]);
  </script>
</body>
</html>
